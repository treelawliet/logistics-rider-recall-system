# 即时物流骑手智能召回系统 - 使用指南

## 🚀 快速开始

### 1. 环境准备

确保你的系统已安装Python 3.8+：
```bash
python3 --version
```

### 2. 运行演示

我们提供了多种运行方式，从简单到复杂：

#### 🎯 方式一：简化演示（推荐新手）
```bash
python3 simple_demo.py
```
**特点**：
- 不依赖复杂外部库
- 快速展示完整工作流
- 自动生成模拟数据
- 适合理解系统原理

#### 🎮 方式二：交互式演示（推荐体验）
```bash
python3 interactive_demo.py
```
**特点**：
- 可选择站点、日期、场景
- 交互式参数设置
- 详细的执行过程展示
- 生成分析报告

#### 🔧 方式三：命令行模式（推荐开发）
```bash
# 运行指定场景
python3 main.py --site-id "site_001" --date "2024-02-14"

# 演示模式（多个场景）
python3 main.py --demo
```

#### 🌐 方式四：Web界面（需要安装streamlit）
```bash
# 安装依赖
pip3 install streamlit

# 启动Web界面
streamlit run app.py
```

## 📋 功能详解

### 🔮 预测分析功能

**作用**：分析节假日前的运力需求，预测是否存在缺口

**输入参数**：
- `site_id`: 站点ID（如：site_001）
- `target_date`: 目标日期（格式：YYYY-MM-DD）
- `include_weather`: 是否包含天气因素

**输出结果**：
- 预测订单量
- 当前运力
- 缺口比例
- 需要召回的骑手数
- 预测置信度
- 建议行动

**示例**：
```python
from agents.prediction_agent import PredictionService, PredictionRequest

service = PredictionService()
request = PredictionRequest(
    site_id="site_001",
    target_date="2024-02-14",  # 情人节
    include_weather=True
)
result = service.predict_demand(request)
print(f"缺口比例: {result.gap_ratio:.2%}")
```

### 📋 决策确认功能

**作用**：基于预测结果和站长反馈，决定是否启动召回

**工作流程**：
1. 接收预测结果
2. 通知站长确认
3. 收集反馈意见
4. 做出最终决策
5. 记录决策日志

**决策规则**：
- 缺口比例 > 10% 且站长同意 → 启动召回
- 缺口比例 ≤ 10% → 不启动召回
- 站长明确拒绝 → 不启动召回

### 👥 骑手筛选功能

**作用**：生成骑手画像，筛选最适合的候选人

**筛选标准**：
- 接单率 ≥ 70%
- 响应时间 ≤ 120秒
- 完成率 ≥ 85%
- 活跃天数 ≥ 7天
- 距离站点 ≤ 5公里

**评分算法**：
- 接单率得分（30%）
- 响应时间得分（20%）
- 完成率得分（25%）
- 距离得分（15%）
- 经验得分（10%）

**紧急程度调整**：
- `high`: 降低要求，扩大候选范围
- `medium`: 使用标准要求
- `low`: 提高要求，精选候选人

### 📞 召回执行功能

**作用**：模拟电话召回过程，记录结果

**执行流程**：
1. 按优先级排序候选人
2. 依次拨打电话
3. 记录通话结果
4. 分析意愿等级
5. 统计成功率

**结果分类**：
- ✅ 同意：骑手同意出勤
- 📞 拒绝：接通但拒绝
- ❌ 未接：未能接通

### 📊 效果分析功能

**作用**：分析召回效果，生成改进建议

**关键指标**：
- **召回成功率** = 同意人数 / 拨打总数
- **接通率** = 接通次数 / 拨打总数
- **同意率** = 同意人数 / 接通次数
- **目标完成率** = 实际召回 / 需要人数

**改进建议**：
- 成功率偏低 → 优化筛选标准
- 接通率偏低 → 调整拨打时间
- 目标未达成 → 扩大候选范围

## 🎮 演示场景说明

### 场景1：正常场景
- **特点**：轻微缺口（10-20%）
- **目的**：展示标准工作流
- **预期**：中等成功率

### 场景2：繁忙场景  
- **特点**：中等缺口（20-40%）
- **目的**：测试高负荷情况
- **预期**：需要更多候选人

### 场景3：危机场景
- **特点**：严重缺口（40%+）
- **目的**：测试紧急响应
- **预期**：启用高紧急度模式

### 场景4：充足场景
- **特点**：无缺口或轻微缺口
- **目的**：测试无需召回情况
- **预期**：系统建议不召回

### 场景5：随机场景
- **特点**：系统随机生成
- **目的**：测试系统适应性
- **预期**：展示不同情况处理

## 📊 结果文件说明

### workflow_result.json
完整工作流的执行结果，包含：
- 预测结果
- 决策过程
- 候选骑手信息
- 召回执行结果
- 效果分析

### demo_result_*.json
演示执行的详细结果，包含：
- 时间戳
- 参数设置
- 各阶段结果
- 性能指标

### logs/system.log
系统运行日志，包含：
- 执行过程记录
- 错误信息
- 性能数据

## 🔧 配置参数说明

### config/settings.py 主要参数

```python
# 预测配置
PREDICTION_THRESHOLD = 0.1      # 缺口阈值（10%）
FORECAST_DAYS = 3               # 提前预测天数

# 召回配置
MAX_CALL_ATTEMPTS = 3           # 最大拨打次数
CALL_TIMEOUT = 30               # 通话超时（秒）
RECALL_BATCH_SIZE = 10          # 批量召回数量

# 筛选配置
MIN_ACCEPTANCE_RATE = 0.7       # 最低接单率
MIN_RESPONSE_TIME = 60          # 最低响应时间
ACTIVE_DAYS_THRESHOLD = 7       # 活跃天数阈值

# 目标配置
SUCCESS_RATE_TARGET = 0.85      # 目标成功率
ATTENDANCE_RATE_TARGET = 0.90   # 目标出勤率
```

## 🐛 常见问题

### Q1: 运行时提示缺少依赖库
**A**: 大部分演示不需要复杂依赖，推荐使用 `simple_demo.py` 或 `interactive_demo.py`

### Q2: 预测结果不准确
**A**: 这是演示系统，使用模拟数据。实际项目中会接入真实的历史数据和机器学习模型。

### Q3: 召回成功率偏低
**A**: 这是正常现象，真实场景中成功率通常在20-40%。可以通过优化筛选标准和激励机制提升。

### Q4: Web界面无法启动
**A**: 需要先安装streamlit：`pip3 install streamlit`，如果网络问题无法安装，可以使用命令行模式。

### Q5: 如何修改业务规则
**A**: 编辑 `config/settings.py` 文件中的参数，或修改 `BUSINESS_RULES` 字典。

## 🚀 扩展开发

### 添加新的Agent
1. 在 `agents/` 目录创建新文件
2. 继承 `Agent` 类并定义工具
3. 在主工作流中集成

### 添加新的工具
1. 继承 `BaseTool` 类
2. 实现 `_run` 方法
3. 添加到对应Agent的工具列表

### 修改数据模型
1. 编辑 `models/schemas.py`
2. 使用Pydantic定义新模型
3. 更新相关Agent的输入输出

### 集成外部API
1. 在工具的 `_run` 方法中调用API
2. 处理异常和超时
3. 添加配置参数

## 📞 技术支持

如果在使用过程中遇到问题：

1. **查看日志**：检查 `logs/system.log` 文件
2. **检查配置**：确认 `config/settings.py` 参数
3. **简化测试**：使用 `simple_demo.py` 验证基础功能
4. **查看文档**：阅读 `README.md` 和 `PROJECT_SUMMARY.md`

---

**祝你使用愉快！** 🎉

这个系统展示了多Agent协同在复杂业务场景中的强大能力，希望能为你的项目提供有价值的参考。 